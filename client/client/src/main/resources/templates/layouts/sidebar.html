<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<div th:fragment="sidebar">
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">
        <!-- Sidebar - Brand -->
        <a class="sidebar-brand d-flex align-items-center justify-content-center" th:href="@{/}">
            <div class="sidebar-brand-icon rotate-n-15">
                <i class="fas fa-laugh-wink"></i>
            </div>
            <div class="sidebar-brand-text mx-3">SSAFY Auth<sup>306</sup></div>
        </a>

        <!-- Divider -->
        <hr class="sidebar-divider my-0">

        <!-- Divider -->
        <hr class="sidebar-divider">

        <!-- Heading -->
        <div class="sidebar-heading" style="font-size: large">
            나의 팀
        </div>

        <!-- Nav Item - Pages Collapse Menu -->
        <!-- Placeholder for dynamically loaded team navigation -->
        <div id="teamNavContainer"></div>

        <!-- Divider -->
        <hr class="sidebar-divider">

        <!-- Heading -->
        <div class="sidebar-heading" style="font-size: large">
            내 정보 관리
        </div>

        <!-- Nav Item - mypage -->
        <li class="nav-item">
            <a class="nav-link" th:href="@{/mypage}">
                <i class="fas fa-fw fa-user-circle"></i> <!-- 마이페이지 아이콘을 사용자 아이콘으로 변경 -->
                <span>마이페이지</span>
            </a>
        </li>

        <!-- Nav Item - logout -->
        <li class="nav-item">
            <a class="nav-link" th:href="@{/logout}">
                <i class="fas fa-fw fa-sign-out-alt"></i> <!-- 로그아웃 아이콘을 출구 아이콘으로 변경 -->
                <span>로그아웃</span>
            </a>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider d-none d-md-block">

        <!-- Sidebar Toggler (Sidebar) -->
        <div class="text-center d-none d-md-inline">
            <button class="rounded-circle border-0" id="sidebarToggle"></button>
        </div>

    </ul>

    <script>
        // 사이드바가 로드될 때 팀 목록을 동적으로 로드하여 네비게이션을 생성합니다.
        $(document).ready(function() {
            console.log("여기는 사이드바");
            loadTeams();
        });

        function loadTeams() {
            var token = getCookie("access_token");
            console.log(token);
            $.ajax({
                url: 'http://localhost:8090/api/team',
                type: 'GET',
                headers: {
                    "Authorization": 'Bearer ' + token
                },
                success: function (response) {
                    console.log(response);
                    populateSidebar(response);
                },
                error: function (xhr, status, error) {
                    console.error('Error loading data:', error);
                }
            });
        }

        function populateSidebar(data) {
            var container = document.getElementById('teamNavContainer');
            container.innerHTML = ''; // Clear previous entries
            data.forEach(function (team, index) {
                var teamNavItem = document.createElement('li');
                teamNavItem.classList.add('nav-item');
                teamNavItem.innerHTML = `
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapse${index}"
                   aria-expanded="true" aria-controls="collapse${index}">
                    <i class="fas fa-fw fa-cog"></i>
                    <span>${team.teamName}</span>
                </a>
                <div id="collapse${index}" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">관리</h6>
                        <a class="collapse-item" href="/buttons">요약 정보</a>
                        <a class="collapse-item" href="/dashboard">대시보드</a>
                        <a class="collapse-item" href="/cards">동의 항목</a>
                        <a class="collapse-item" href="/management">팀 관리</a>
                        <a class="collapse-item" href="/settings">설정</a>
                    </div>
                </div>`;
                container.appendChild(teamNavItem);
            });
        }

        function getCookie(name) {
            let value = `; ${document.cookie}`;
            let parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }
    </script>
</div>


</html>
